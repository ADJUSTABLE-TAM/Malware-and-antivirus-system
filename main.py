import hashlib
import os
import tkinter as tk
from tkinter import filedialog


def scan1(file):
    virus = False
    with open(file, "r") as f:
        text = f.read()
        with open("MD5.txt", 'r') as f:
            lines = [line.rstrip() for line in f]
            for line in lines:
                if str(text) == str(line.split(";")[0]):
                    virus = True
    f.close()
    if not virus:
        print("File is safe!")
        status.configure(text="Status: File is safe!", width=100, height=4, fg="green")
        scan2(file)
    else:
        print("Virus detected!")
        status.configure(text="Status: Virus detected! File Deleted!", width=100, height=4, fg="red")
        os.remove(file)


def scan2(file1):
    virus = False
    with open(file1, "rb") as f:
        text = f.read()
        hashing = hashlib.md5(text).hexdigest()
        with open("MD5.txt", 'r') as f:
            lines = [line.rstrip() for line in f]
            for line in lines:
                if str(hashing) == str(line.split(";")[0]):
                    virus = True
    f.close()
    if not virus:
        print("File is safe!")
        status.configure(text="Status: File is safe!", width=100, height=4, fg="green")
        convert1(file1)
    else:
        print("Virus detected!")
        status.configure(text="Status: Virus detected! File Deleted!", width=100, height=4, fg="red")
        os.remove(file1)


def convert1(type1):
    with open(type1, 'rb') as f1, open("text.txt", "wb") as f:
        for line in f1:
            f.write(line)
    scanning(type1)


def scanning(type2):
    virus = False
    with open("text.txt", "rb") as f:
        text = f.read()
        hashing = hashlib.md5(text).hexdigest()
        with open("MD5.txt", 'r') as f:
            lines = [line.rstrip() for line in f]
            for line in lines:
                if str(hashing) == str(line.split(";")[0]):
                    virus = True
    f.close()
    if not virus:
        print("File is safe!")
        status.configure(text="Status: File is safe!", width=100, height=4, fg="green")
    else:
        print("Virus detected!")
        status.configure(text="Status: Virus detected! File Deleted!", width=100, height=4, fg="red")
        os.remove(type2)


def browse_files():
    types = [("All files", "*.*"),
             ('Java code files', '*.java'),
             ("Text files", "*.*"),
             ('Python code files', '*.py')]

    filename = filedialog.askopenfilename(initialdir="/", title="Select a File", filetypes=types)

    o_f.configure(text="File Opened: " + filename)

    scan1(filename)


window = tk.Tk()

window.title('Antivirus')

window.geometry("500x500")

window.config(background="white")

anti = tk.Label(text="Antivirus", width=100, height=4, font=("Arial", 18, "bold"), fg="blue", bg="white")
anti.pack()

status = tk.Label(window, text="Status: Neutral", width=100, height=4, font=("Courier", 10), fg="black", bg="white")
status.place(x=-150, y=300)

o_f = tk.Label(window, width=100, height=4, font=("Courier", 10), fg="black", bg="white")
o_f.place(x=-150, y=250)

b1 = tk.Button(window, text="Browse Files", command=browse_files)
b1.place(x=205, y=400)

window.mainloop()
